# Hostel Manager - Backend

Django REST API для управления хостелом с панелью администратора.

## Функции

### Для администратора (логин: Kvv, пароль: Kvv08072001):
- ✅ Принятие или отклонение запросов на регистрацию
- ✅ Просмотр логинов и паролей пользователей
- ✅ Просмотр количества пользователей в каждом аккаунте
- ✅ Удаление и блокировка пользователей
- ✅ Разблокировка пользователей
- ✅ Установка срока использования для пользователей
- ✅ Полный журнал аудита всех действий
- ✅ Защита от оффлайн использования (требуется токен авторизации)
- ✅ Защита от взлома (JWT токены, хэширование паролей, CSRF защита)

### Для обычных пользователей:
- Регистрация с ожиданием подтверждения
- Авторизация после одобрения администратора
- Управление комнатами и кроватями
- Управление жильцами
- Просмотр статистики

## Установка

1. Установите Python 3.8 или выше

2. Создайте виртуальное окружение:
```bash
python -m venv venv
```

3. Активируйте виртуальное окружение:

Windows:
```bash
venv\Scripts\activate
```

Linux/Mac:
```bash
source venv/bin/activate
```

4. Установите зависимости:
```bash
pip install -r requirements.txt
```

5. Примените миграции:
```bash
python manage.py makemigrations
python manage.py migrate
```

6. Создайте супер администратора:
```bash
python manage.py init_admin
```

7. Запустите сервер:
```bash
python manage.py runserver
```

Сервер запустится на http://127.0.0.1:8000

## API Endpoints

### Авторизация
- `POST /api/auth/register/` - Регистрация нового пользователя
- `POST /api/auth/login/` - Вход в систему
- `POST /api/auth/logout/` - Выход из системы
- `GET /api/auth/me/` - Получить текущего пользователя

### Администрирование (только для супер-админа)
- `GET /api/admin/stats/` - Статистика системы
- `GET /api/users/` - Список пользователей
- `POST /api/users/{id}/approve/` - Одобрить пользователя
- `POST /api/users/{id}/suspend/` - Заблокировать пользователя
- `POST /api/users/{id}/unsuspend/` - Разблокировать пользователя
- `POST /api/users/{id}/set_access_period/` - Установить срок доступа
- `DELETE /api/users/{id}/` - Удалить пользователя

### Комнаты
- `GET /api/rooms/` - Список комнат
- `POST /api/rooms/` - Создать комнату
- `PUT /api/rooms/{id}/` - Обновить комнату
- `DELETE /api/rooms/{id}/` - Удалить комнату

### Кровати
- `GET /api/beds/` - Список кроватей
- `POST /api/beds/` - Создать кровать
- `PUT /api/beds/{id}/` - Обновить кровать
- `DELETE /api/beds/{id}/` - Удалить кровать

### Жильцы
- `GET /api/residents/` - Список жильцов
- `POST /api/residents/` - Создать жильца
- `PUT /api/residents/{id}/` - Обновить жильца
- `DELETE /api/residents/{id}/` - Удалить жильца

### Журнал аудита (только для супер-админа)
- `GET /api/audit-logs/` - Журнал всех действий

## Безопасность

1. **JWT Authentication** - Все запросы требуют токен авторизации
2. **Password Hashing** - Пароли хэшируются с использованием Django's PBKDF2
3. **CSRF Protection** - Защита от CSRF атак
4. **Session Security** - Безопасные настройки сессий
5. **Audit Log** - Полное логирование всех действий
6. **Role-Based Access** - Разграничение прав доступа

## Данные для входа администратора

**Логин:** Kvv  
**Пароль:** Kvv08072001

## Структура проекта

```
back/
├── hostel_project/         # Настройки Django
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
├── hostel_app/            # Основное приложение
│   ├── models.py          # Модели БД
│   ├── views.py           # API Views
│   ├── serializers.py     # Сериализаторы
│   ├── urls.py            # URL маршруты
│   └── management/        # Команды управления
├── manage.py
└── requirements.txt
```

## Модели данных

- **CustomUser** - Пользователи с расширенными полями
- **Room** - Комнаты хостела
- **Bed** - Кровати в комнатах
- **Resident** - Жильцы
- **AuditLog** - Журнал действий
- **SystemSettings** - Системные настройки
