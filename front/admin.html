<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî• –ü–∞–Ω–µ–ª—å –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ v3.0 PRO</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(-45deg, #070518, #0d1b2a, #1b263b, #0d0d1f);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            color: #eaf8ff;
            padding: 20px;
            min-height: 100vh;
        }
        .container { max-width: 1600px; margin: 0 auto; animation: slideDown 0.5s ease; }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(124,77,255,0.2), rgba(0,229,255,0.2));
            border-radius: 15px;
            border: 2px solid rgba(124,77,255,0.5);
        }
        .title {
            font-size: 36px;
            font-weight: bold;
            background: linear-gradient(135deg, #00ffff, #7c4dff, #ff54bf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(124,77,255,0.5);
        }
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary { background: linear-gradient(90deg, #7c4dff, #00e5ff); color: #fff; }
        .btn-danger { background: #ff4757; color: #fff; }
        .btn:hover { transform: translateY(-2px); }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab-btn {
            padding: 15px 30px;
            border: 2px solid;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            opacity: 0.6;
        }
        .tab-btn.active { opacity: 1; transform: scale(1.05); }
        .content {
            min-height: 400px;
            background: rgba(255,255,255,0.03);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .user-card {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border: 2px solid;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s;
            animation: slideDown 0.5s ease;
        }
        
        .user-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(124,77,255,0.3);
        }
        .user-header { font-size: 24px; color: #00ffff; margin-bottom: 15px; }
        .user-info {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .info-row { color: #eee; margin-bottom: 10px; }
        .info-value {
            background: rgba(124,77,255,0.3);
            padding: 5px 15px;
            border-radius: 5px;
            font-family: monospace;
        }
        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .empty { text-align: center; padding: 60px; color: #888; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">üî• –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ v3.0 PRO üìÖ</div>
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-primary" onclick="window.location.href='index.html'">üè† –ù–∞–∑–∞–¥</button>
                <button class="btn btn-danger" onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
            </div>
        </div>

        <div style="background: rgba(124,77,255,0.1); padding: 20px; border-radius: 15px; margin-bottom: 30px;">
            <h3 style="color: #00ffff; margin-bottom: 10px;">üë§ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: <span id="adminName">...</span></h3>
        </div>

        <div class="tabs">
            <button class="tab-btn" id="tabPending" onclick="showTab('pending')" style="background: rgba(255,165,2,0.2); border-color: #ffa502; color: #ffa502;">
                ‚è≥ –û–∂–∏–¥–∞—é—Ç (<span id="countPending">0</span>)
            </button>
            <button class="tab-btn active" id="tabActive" onclick="showTab('active')" style="background: rgba(0,255,136,0.2); border-color: #00ff88; color: #00ff88;">
                ‚úÖ –ê–∫—Ç–∏–≤–Ω—ã–µ (<span id="countActive">0</span>)
            </button>
            <button class="tab-btn" id="tabBlocked" onclick="showTab('blocked')" style="background: rgba(255,71,87,0.2); border-color: #ff4757; color: #ff4757;">
                üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ (<span id="countBlocked">0</span>)
            </button>
        </div>

        <div class="content" id="content"></div>
    </div>

    <!-- Date Picker Modal -->
    <div id="dateModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);backdrop-filter:blur(10px);z-index:9999;justify-content:center;align-items:center;">
        <div style="background:linear-gradient(135deg,#1b263b,#0d1b2a);border:2px solid rgba(124,77,255,0.5);border-radius:20px;padding:30px;max-width:500px;width:90%;box-shadow:0 20px 60px rgba(0,0,0,0.8);">
            <h2 style="color:#00ffff;font-size:24px;margin-bottom:20px;">üìÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ä–æ–∫ –¥–æ—Å—Ç—É–ø–∞</h2>
            
            <div style="background:rgba(124,77,255,0.1);padding:15px;border-radius:10px;margin-bottom:20px;">
                <div style="color:#00ffff;font-weight:bold;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <span id="modalUsername" style="color:#7c4dff;">...</span></div>
            </div>
            
            <div style="margin-bottom:20px;">
                <div style="color:#888;font-weight:bold;margin-bottom:10px;">‚ö° –ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä:</div>
                <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;">
                    <button onclick="setQuickDate(7)" style="padding:12px;background:rgba(124,77,255,0.2);border:1px solid rgba(124,77,255,0.5);border-radius:8px;color:#fff;cursor:pointer;transition:all 0.3s;" onmouseover="this.style.background='rgba(124,77,255,0.4)'" onmouseout="this.style.background='rgba(124,77,255,0.2)'">7 –¥–Ω–µ–π</button>
                    <button onclick="setQuickDate(14)" style="padding:12px;background:rgba(124,77,255,0.2);border:1px solid rgba(124,77,255,0.5);border-radius:8px;color:#fff;cursor:pointer;" onmouseover="this.style.background='rgba(124,77,255,0.4)'" onmouseout="this.style.background='rgba(124,77,255,0.2)'">14 –¥–Ω–µ–π</button>
                    <button onclick="setQuickDate(30)" style="padding:12px;background:rgba(124,77,255,0.2);border:1px solid rgba(124,77,255,0.5);border-radius:8px;color:#fff;cursor:pointer;" onmouseover="this.style.background='rgba(124,77,255,0.4)'" onmouseout="this.style.background='rgba(124,77,255,0.2)'">30 –¥–Ω–µ–π</button>
                    <button onclick="setQuickDate(60)" style="padding:12px;background:rgba(124,77,255,0.2);border:1px solid rgba(124,77,255,0.5);border-radius:8px;color:#fff;cursor:pointer;" onmouseover="this.style.background='rgba(124,77,255,0.4)'" onmouseout="this.style.background='rgba(124,77,255,0.2)'">60 –¥–Ω–µ–π</button>
                    <button onclick="setQuickDate(90)" style="padding:12px;background:rgba(124,77,255,0.2);border:1px solid rgba(124,77,255,0.5);border-radius:8px;color:#fff;cursor:pointer;" onmouseover="this.style.background='rgba(124,77,255,0.4)'" onmouseout="this.style.background='rgba(124,77,255,0.2)'">90 –¥–Ω–µ–π</button>
                    <button onclick="setQuickDate(0)" style="padding:12px;background:rgba(0,255,136,0.2);border:1px solid rgba(0,255,136,0.5);border-radius:8px;color:#fff;cursor:pointer;" onmouseover="this.style.background='rgba(0,255,136,0.4)'" onmouseout="this.style.background='rgba(0,255,136,0.2)'">‚ôæÔ∏è –ë–µ—Å—Å—Ä–æ—á–Ω–æ</button>
                </div>
            </div>
            
            <div style="margin-bottom:20px;">
                <div style="color:#888;font-weight:bold;margin-bottom:10px;">üìÖ –ò–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:</div>
                <input type="date" id="dateInput" style="width:100%;padding:15px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.2);border-radius:10px;color:#fff;font-size:16px;" onfocus="this.style.borderColor='#7c4dff';this.style.boxShadow='0 0 20px rgba(124,77,255,0.3)'" onblur="this.style.borderColor='rgba(255,255,255,0.2)';this.style.boxShadow='none'">
            </div>
            
            <div style="display:flex;gap:10px;">
                <button onclick="saveDate()" style="flex:1;padding:15px;background:linear-gradient(90deg,#7c4dff,#00e5ff);border:none;border-radius:10px;color:#fff;font-weight:bold;cursor:pointer;transition:all 0.3s;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 5px 20px rgba(124,77,255,0.5)'" onmouseout="this.style.transform='';this.style.boxShadow=''">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button onclick="closeModal()" style="flex:1;padding:15px;background:linear-gradient(90deg,#ff4757,#ff6b81);border:none;border-radius:10px;color:#fff;font-weight:bold;cursor:pointer;transition:all 0.3s;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 5px 20px rgba(255,71,87,0.5)'" onmouseout="this.style.transform='';this.style.boxShadow=''">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script>
        const USERS_KEY = 'hostelManagerUsers';
        let users = JSON.parse(localStorage.getItem(USERS_KEY)) || {};
        
        // Check admin
        const currentUsername = localStorage.getItem('hostelCurrentUser');
        console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞:');
        console.log('  currentUsername:', currentUsername);
        console.log('  users:', users);
        console.log('  users[currentUsername]:', users[currentUsername]);
        console.log('  role:', users[currentUsername]?.role);
        
        if (!currentUsername) {
            alert('‚ö†Ô∏è –í—ã –Ω–µ –≤–æ—à–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—É!');
            window.location.href = 'index.html';
        } else if (!users[currentUsername]) {
            alert('‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω!');
            window.location.href = 'index.html';
        } else if (users[currentUsername].role !== 'admin') {
            alert('‚ö†Ô∏è –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!');
            window.location.href = 'index.html';
        }
        
        document.getElementById('adminName').textContent = currentUsername;
        checkExpiredUsers();
        updateCounts();
        showTab('active');
        
        // Check for expired users and auto-suspend them
        function checkExpiredUsers() {
            let expiredCount = 0;
            let autoSuspendedCount = 0;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            Object.entries(users).forEach(([username, userData]) => {
                if (userData.status === 'active' && userData.accessExpires) {
                    const expiryDate = new Date(userData.accessExpires);
                    expiryDate.setHours(0, 0, 0, 0);
                    
                    if (expiryDate < today) {
                        expiredCount++;
                        
                        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        users[username].status = 'suspended';
                        users[username].suspendedAt = new Date().toISOString();
                        users[username].suspendedReason = `–ò—Å—Ç–µ–∫ —Å—Ä–æ–∫ –¥–æ—Å—Ç—É–ø–∞ (${expiryDate.toLocaleDateString('ru-RU')})`;
                        autoSuspendedCount++;
                    }
                }
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –µ—Å–ª–∏ –±—ã–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
            if (autoSuspendedCount > 0) {
                localStorage.setItem(USERS_KEY, JSON.stringify(users));
                console.log(`üî¥ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${autoSuspendedCount}`);
            }
            
            if (expiredCount > 0) {
                alert(`‚ö†Ô∏è –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ë–õ–û–ö–ò–†–û–í–ö–ê!\n\n${autoSuspendedCount} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª${autoSuspendedCount === 1 ? '—å' : '–µ–π'} —Å –∏—Å—Ç–µ–∫—à–∏–º —Å—Ä–æ–∫–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω${autoSuspendedCount === 1 ? '' : '—ã'}!\n\n–ü—Ä–∏—á–∏–Ω–∞: –ò—Å—Ç–µ–∫ —Å—Ä–æ–∫ –¥–æ—Å—Ç—É–ø–∞\n\n–û–Ω–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤–æ –≤–∫–ª–∞–¥–∫—É "üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ".\n\n–î–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞:\n1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ"\n2. –†–∞–∑–±–ª–æ–∫–∏—Ä—É–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–≤—ã–π —Å—Ä–æ–∫ –¥–æ—Å—Ç—É–ø–∞`);
            }
        }
        
        function updateCounts() {
            let pending = 0, active = 0, blocked = 0;
            Object.entries(users).forEach(([username, userData]) => {
                if (userData.status === 'pending') pending++;
                else if (userData.status === 'active' && userData.role !== 'admin') active++;
                else if (userData.status === 'suspended') blocked++;
            });
            document.getElementById('countPending').textContent = pending;
            document.getElementById('countActive').textContent = active;
            document.getElementById('countBlocked').textContent = blocked;
        }
        
        function showTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('active');
            
            if (tab === 'pending') renderPending();
            else if (tab === 'active') renderActive();
            else if (tab === 'blocked') renderBlocked();
        }
        
        function renderPending() {
            let html = '';
            let count = 0;
            Object.entries(users).forEach(([username, userData]) => {
                if (userData.status === 'pending') {
                    count++;
                    html += `<div class="user-card" style="border-color: #ffa502;">
                        <div class="user-header">üë§ ${username}</div>
                        <div class="user-info">
                            <div class="info-row"><strong style="color:#ffa502;">üîë –õ–æ–≥–∏–Ω:</strong> <span class="info-value">${username}</span></div>
                            <div class="info-row"><strong style="color:#ff4757;">üîí –ü–∞—Ä–æ–ª—å:</strong> <span class="info-value">${userData.password}</span></div>
                            <div class="info-row">üìÖ ${new Date(userData.createdAt).toLocaleDateString('ru-RU')}</div>
                        </div>
                        <button class="action-btn" style="background:#00ff88;color:#000;" onclick="approve('${username}')">‚úÖ –û–î–û–ë–†–ò–¢–¨</button>
                        <button class="action-btn" style="background:#ff4757;color:#fff;" onclick="reject('${username}')">‚ùå –û–¢–ö–õ–û–ù–ò–¢–¨</button>
                    </div>`;
                }
            });
            document.getElementById('content').innerHTML = html || '<div class="empty">üì≠ –ù–µ—Ç –æ–∂–∏–¥–∞—é—â–∏—Ö</div>';
        }
        
        function renderActive() {
            let html = '';
            Object.entries(users).forEach(([username, userData]) => {
                if (userData.status === 'active' && userData.role !== 'admin') {
                    const count = userData.residentsCount || 0;
                    const expires = userData.accessExpires ? new Date(userData.accessExpires).toLocaleDateString('ru-RU') : '‚àû –ë–µ—Å—Å—Ä–æ—á–Ω—ã–π';
                    const expired = userData.accessExpires && new Date(userData.accessExpires) < new Date();
                    
                    html += `<div class="user-card" style="border-color: ${expired ? '#ff4757' : '#00ff88'}; background: ${expired ? 'rgba(255,71,87,0.05)' : 'rgba(0,255,136,0.05)'};">
                        <div class="user-header" style="color: ${expired ? '#ff4757' : '#00ffff'};">
                            üë§ ${username} ${expired ? '‚ö†Ô∏è –°–†–û–ö –ò–°–¢–ï–ö!' : '‚úÖ'}
                        </div>
                        <div class="user-info">
                            ${expired ? '<div class="info-row" style="background:rgba(255,71,87,0.2);padding:10px;border-radius:8px;margin-bottom:10px;"><strong style="color:#ff4757;">‚ö†Ô∏è –î–û–°–¢–£–ü –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù:</strong> <span style="color:#ff4757;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É –¥–æ –ø—Ä–æ–¥–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞</span></div>' : ''}
                            <div class="info-row"><strong style="color:#ffa502;">üîë –õ–æ–≥–∏–Ω:</strong> <span class="info-value">${username}</span></div>
                            <div class="info-row"><strong style="color:#ff4757;">üîí –ü–∞—Ä–æ–ª—å:</strong> <span class="info-value">${userData.password}</span></div>
                            <div class="info-row"><strong style="color:#00ffff;">üë• –ñ–∏–ª—å—Ü–æ–≤:</strong> <span style="color:#00ff88;font-size:18px;font-weight:bold;">${count} —á–µ–ª.</span></div>
                            <div class="info-row" style="color: ${expired ? '#ff4757' : '#eee'}; font-weight: ${expired ? 'bold' : 'normal'};">‚è∞ –î–æ: ${expires} ${expired ? '‚ùå' : '‚úÖ'}</div>
                            <div class="info-row">üìÖ ${new Date(userData.createdAt).toLocaleDateString('ru-RU')}</div>
                        </div>
                        <button class="action-btn" style="background:linear-gradient(90deg,#7c4dff,#00e5ff);color:#fff;" onclick="loginAs('${username}')">üîç –ü–†–û–í–ï–†–ò–¢–¨</button>
                        <button class="action-btn" style="background:#ffa502;color:#000;" onclick="setExpiry('${username}')">‚è∞ –°–†–û–ö</button>
                        <button class="action-btn" style="background:#ff4757;color:#fff;" onclick="block('${username}')">üö´ –ë–õ–û–ö–ò–†–û–í–ê–¢–¨</button>
                        ${username !== currentUsername ? `<button class="action-btn" style="background:#444;color:#fff;" onclick="del('${username}')">üóëÔ∏è –£–î–ê–õ–ò–¢–¨</button>` : ''}
                    </div>`;
                }
            });
            document.getElementById('content').innerHTML = html || '<div class="empty">üì≠ –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö</div>';
        }
        
        function renderBlocked() {
            let html = '';
            Object.entries(users).forEach(([username, userData]) => {
                if (userData.status === 'suspended') {
                    const suspendReason = userData.suspendedReason || '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º';
                    const isAutoSuspended = suspendReason.includes('–ò—Å—Ç–µ–∫ —Å—Ä–æ–∫');
                    
                    html += `<div class="user-card" style="border-color: #ff4757; background: rgba(255,71,87,0.05);">
                        <div class="user-header" style="color: #ff4757;">üö´ ${username}</div>
                        <div class="user-info">
                            ${isAutoSuspended ? '<div class="info-row" style="background:rgba(255,165,2,0.2);padding:10px;border-radius:8px;margin-bottom:10px;"><strong style="color:#ffa502;">‚è∞ –ê–í–¢–û–ë–õ–û–ö–ò–†–û–í–ö–ê:</strong> <span style="color:#ffa502;">${suspendReason}</span></div>' : ''}
                            <div class="info-row"><strong style="color:#ffa502;">üîë –õ–æ–≥–∏–Ω:</strong> <span class="info-value">${username}</span></div>
                            <div class="info-row"><strong style="color:#ff4757;">üîí –ü–∞—Ä–æ–ª—å:</strong> <span class="info-value">${userData.password}</span></div>
                            <div class="info-row"><strong style="color:#ff4757;">‚õî –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω:</strong> ${userData.suspendedAt ? new Date(userData.suspendedAt).toLocaleDateString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
                            ${userData.suspendedReason ? `<div class="info-row"><strong style="color:#888;">üìù –ü—Ä–∏—á–∏–Ω–∞:</strong> ${suspendReason}</div>` : ''}
                        </div>
                        <button class="action-btn" style="background:#00ff88;color:#000;" onclick="unblock('${username}')">‚úÖ –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–¢–¨</button>
                        <button class="action-btn" style="background:#444;color:#fff;" onclick="del('${username}')">üóëÔ∏è –£–î–ê–õ–ò–¢–¨</button>
                    </div>`;
                }
            });
            document.getElementById('content').innerHTML = html || '<div class="empty">üì≠ –ù–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö</div>';
        }
        
        function approve(username) {
            if (!confirm(`–û–¥–æ–±—Ä–∏—Ç—å ${username}?`)) return;
            const days = prompt('–ù–∞ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π? (0 = –±–µ—Å—Å—Ä–æ—á–Ω–æ)', '30');
            if (days === null) return;
            
            users[username].status = 'active';
            if (days !== '0') {
                const d = new Date();
                d.setDate(d.getDate() + parseInt(days));
                users[username].accessExpires = d.toISOString().split('T')[0];
            }
            localStorage.setItem(USERS_KEY, JSON.stringify(users));
            alert('‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ!');
            updateCounts();
            showTab('active');
        }
        
        function reject(username) {
            if (!confirm(`–û—Ç–∫–ª–æ–Ω–∏—Ç—å ${username}?`)) return;
            delete users[username];
            localStorage.setItem(USERS_KEY, JSON.stringify(users));
            alert('‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ');
            updateCounts();
            showTab('pending');
        }
        
        function block(username) {
            const reason = prompt(`–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å ${username}?\n\n–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):`, '');
            if (reason === null) return;
            
            users[username].status = 'suspended';
            users[username].suspendedAt = new Date().toISOString();
            if (reason.trim()) {
                users[username].suspendedReason = reason.trim();
            } else {
                users[username].suspendedReason = '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º';
            }
            localStorage.setItem(USERS_KEY, JSON.stringify(users));
            alert('üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');
            updateCounts();
            showTab('blocked');
        }
        
        function unblock(username) {
            const wasAutoSuspended = users[username].suspendedReason?.includes('–ò—Å—Ç–µ–∫ —Å—Ä–æ–∫');
            
            if (wasAutoSuspended) {
                if (!confirm(`–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å ${username}?\n\n‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏–∑-–∑–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞.\n\n–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å—Ä–æ–∫ –¥–æ—Å—Ç—É–ø–∞!\n\n–í—Å–µ —Ä–∞–≤–Ω–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å?`)) return;
            } else {
                if (!confirm(`–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å ${username}?`)) return;
            }
            
            users[username].status = 'active';
            delete users[username].suspendedAt;
            delete users[username].suspendedReason;
            localStorage.setItem(USERS_KEY, JSON.stringify(users));
            
            if (wasAutoSuspended) {
                alert('‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!\n\n‚ö†Ô∏è –ù–ï –ó–ê–ë–£–î–¨–¢–ï —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å—Ä–æ–∫ –¥–æ—Å—Ç—É–ø–∞!');
            } else {
                alert('‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');
            }
            
            updateCounts();
            showTab('active');
        }
        
        function del(username) {
            if (!confirm(`–£–î–ê–õ–ò–¢–¨ ${username}?`)) return;
            if (!confirm('–í–´ –£–í–ï–†–ï–ù–´?')) return;
            delete users[username];
            localStorage.setItem(USERS_KEY, JSON.stringify(users));
            alert('üóëÔ∏è –£–¥–∞–ª–µ–Ω');
            updateCounts();
            showTab('active');
        }
        
        let currentEditUsername = null;
        
        function setExpiry(username) {
            currentEditUsername = username;
            document.getElementById('modalUsername').textContent = username;
            document.getElementById('dateModal').style.display = 'flex';
            
            // Set today as minimum date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateInput').setAttribute('min', today);
            document.getElementById('dateInput').value = '';
        }
        
        function closeModal() {
            document.getElementById('dateModal').style.display = 'none';
            currentEditUsername = null;
        }
        
        function setQuickDate(days) {
            if (days === 0) {
                document.getElementById('dateInput').value = '';
                return;
            }
            
            const d = new Date();
            d.setDate(d.getDate() + days);
            document.getElementById('dateInput').value = d.toISOString().split('T')[0];
        }
        
        function saveDate() {
            if (!currentEditUsername) return;
            
            const dateValue = document.getElementById('dateInput').value;
            
            if (!dateValue) {
                // –ë–µ—Å—Å—Ä–æ—á–Ω–æ
                delete users[currentEditUsername].accessExpires;
                localStorage.setItem(USERS_KEY, JSON.stringify(users));
                alert(`‚úÖ –î–ª—è ${currentEditUsername} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ë–ï–°–°–†–û–ß–ù–´–ô –¥–æ—Å—Ç—É–ø!`);
            } else {
                users[currentEditUsername].accessExpires = dateValue;
                localStorage.setItem(USERS_KEY, JSON.stringify(users));
                const expDate = new Date(dateValue);
                alert(`‚úÖ –î–ª—è ${currentEditUsername} —Å—Ä–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–æ:\\n${expDate.toLocaleDateString('ru-RU', {day: 'numeric', month: 'long', year: 'numeric'})}`);
            }
            
            closeModal();
            updateCounts();
            showTab('active');
        }
        
        function loginAs(username) {
            if (!confirm(`–ó–∞–π—Ç–∏ –∫–∞–∫ ${username}?\\n\\n–ß—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è - –≤—ã–π–¥–∏—Ç–µ –∏ –≤–æ–π–¥–∏—Ç–µ –∫–∞–∫ ${currentUsername}`)) return;
            localStorage.setItem('hostelCurrentUser', username);
            alert(`‚úÖ –í—ã –∑–∞—à–ª–∏ –∫–∞–∫ ${username}\\n\\nüîô –í—ã–π–¥–∏—Ç–µ –∏ –≤–æ–π–¥–∏—Ç–µ –∫–∞–∫ ${currentUsername} —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è`);
            window.location.href = 'index.html';
        }
        
        function logout() {
            if (confirm('–í—ã–π—Ç–∏?')) {
                localStorage.removeItem('hostelCurrentUser');
                window.location.href = 'index.html';
            }
        }
    </script>
</body>
</html>
